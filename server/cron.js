var MyCron = new Cron(/* interval in milliseconds, defaults to 60000 (1 minute) */);
//var _localStorage = Meteor.require("localStorage")
//console.log('-localStorage', _localStorage);

var db;

function LocalStorage() {
}
db = LocalStorage;

db.prototype.getItem = function (key) {
    if (this.hasOwnProperty(key)) {
        return String(this[key]);
    }
    return null;
};

db.prototype.setItem = function (key, val) {
    this[key] = String(val);
};

db.prototype.removeItem = function (key) {
    delete this[key];
};

db.prototype.clear = function () {
    var self = this;
    Object.keys(self).forEach(function (key) {
        self[key] = undefined;
        delete self[key];
    });
};

db.prototype.key = function (i) {
    i = i || 0;
    return Object.keys(this)[i];
};

db.prototype.__defineGetter__('length', function () {
    return Object.keys(this).length;
});
module = {};
if (global.localStorage) {
    module.exports = localStorage;
} else {
    module.exports = new LocalStorage();
}

db2 = new LocalStorage();

/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */
var Url=Npm.require("url"),spawn=Npm.require("child_process").spawn,fs=Npm.require("fs");var XMLHttpRequest=function(){var e=this;var t=Npm.require("http");var n=Npm.require("https");var r;var i;var s={};var o=false;var u={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"};var a=u;var f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"];var l=["TRACE","TRACK","CONNECT"];var c=false;var h=false;var p={};this.UNSENT=0;this.OPENED=1;this.HEADERS_RECEIVED=2;this.LOADING=3;this.DONE=4;this.readyState=this.UNSENT;this.onreadystatechange=null;this.responseText="";this.responseXML="";this.status=null;this.statusText=null;var d=function(e){return o||e&&f.indexOf(e.toLowerCase())===-1};var v=function(e){return e&&l.indexOf(e)===-1};this.open=function(e,t,n,r,i){this.abort();h=false;if(!v(e)){throw"SecurityError: Request method not allowed"}s={method:e,url:t.toString(),async:typeof n!=="boolean"?true:n,user:r||null,password:i||null};m(this.OPENED)};this.setDisableHeaderCheck=function(e){o=e};this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED){throw"INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN"}if(!d(e)){console.warn('Refused to set unsafe header "'+e+'"');return}if(c){throw"INVALID_STATE_ERR: send flag is true"}a[e]=t};this.getResponseHeader=function(e){if(typeof e==="string"&&this.readyState>this.OPENED&&i.headers[e.toLowerCase()]&&!h){return i.headers[e.toLowerCase()]}return null};this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||h){return""}var e="";for(var t in i.headers){if(t!=="set-cookie"&&t!=="set-cookie2"){e+=t+": "+i.headers[t]+"\r\n"}}return e.substr(0,e.length-2)};this.getRequestHeader=function(e){if(typeof e==="string"&&a[e]){return a[e]}return""};this.send=function(o){if(this.readyState!=this.OPENED){throw"INVALID_STATE_ERR: connection must be opened before send() is called"}if(c){throw"INVALID_STATE_ERR: send has already been called"}var u=false,f=false;var l=Url.parse(s.url);var p;switch(l.protocol){case"https:":u=true;case"http:":p=l.hostname;break;case"file:":f=true;break;case undefined:case"":p="localhost";break;default:throw"Protocol not supported."}if(f){if(s.method!=="GET"){throw"XMLHttpRequest: Only GET method is supported"}if(s.async){fs.readFile(l.pathname,"utf8",function(t,n){if(t){e.handleError(t)}else{e.status=200;e.responseText=n;m(e.DONE)}})}else{try{this.responseText=fs.readFileSync(l.pathname,"utf8");this.status=200;m(e.DONE)}catch(d){this.handleError(d)}}return}var v=l.port||(u?443:80);var g=l.pathname+(l.search?l.search:"");a["Host"]=p;if(!(u&&v===443||v===80)){a["Host"]+=":"+l.port}if(s.user){if(typeof s.password=="undefined"){s.password=""}var y=new Buffer(s.user+":"+s.password);a["Authorization"]="Basic "+y.toString("base64")}if(s.method==="GET"||s.method==="HEAD"){o=null}else if(o){a["Content-Length"]=Buffer.isBuffer(o)?o.length:Buffer.byteLength(o);if(!a["Content-Type"]){a["Content-Type"]="text/plain;charset=UTF-8"}}else if(s.method==="POST"){a["Content-Length"]=0}var b={host:p,port:v,path:g,method:s.method,headers:a,agent:false};h=false;if(s.async){var w=u?n.request:t.request;c=true;e.dispatchEvent("readystatechange");function E(t){i=t;if(i.statusCode===302||i.statusCode===303||i.statusCode===307){s.url=i.headers.location;var n=Url.parse(s.url);p=n.hostname;var o={hostname:n.hostname,port:n.port,path:n.path,method:i.statusCode===303?"GET":s.method,headers:a};r=w(o,E).on("error",S);r.end();return}i.setEncoding("utf8");m(e.HEADERS_RECEIVED);e.status=i.statusCode;i.on("data",function(t){if(t){e.responseText+=t}if(c){m(e.LOADING)}});i.on("end",function(){if(c){m(e.DONE);c=false}});i.on("error",function(t){e.handleError(t)})}function S(t){e.handleError(t)}r=w(b,E).on("error",S);if(o){r.write(o)}r.end();e.dispatchEvent("loadstart")}else{var x=".node-xmlhttprequest-content-"+process.pid;var T=".node-xmlhttprequest-sync-"+process.pid;fs.writeFileSync(T,"","utf8");var N="var http = require('http'), https = require('https'), fs = require('fs');"+"var doRequest = http"+(u?"s":"")+".request;"+"var options = "+JSON.stringify(b)+";"+"var responseText = '';"+"var req = doRequest(options, function(response) {"+"response.setEncoding('utf8');"+"response.on('data', function(chunk) {"+"  responseText += chunk;"+"});"+"response.on('end', function() {"+"fs.writeFileSync('"+x+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');"+"fs.unlinkSync('"+T+"');"+"});"+"response.on('error', function(error) {"+"fs.writeFileSync('"+x+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');"+"fs.unlinkSync('"+T+"');"+"});"+"}).on('error', function(error) {"+"fs.writeFileSync('"+x+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');"+"fs.unlinkSync('"+T+"');"+"});"+(o?"req.write('"+o.replace(/'/g,"\\'")+"');":"")+"req.end();";var C=spawn(process.argv[0],["-e",N]);var k;while(fs.existsSync(T)){}e.responseText=fs.readFileSync(x,"utf8");C.stdin.end();fs.unlinkSync(x);if(e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var L=e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");e.handleError(L)}else{e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");e.responseText=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1");m(e.DONE)}}};this.handleError=function(e){this.status=503;this.statusText=e;this.responseText=e.stack;h=true;m(this.DONE)};this.abort=function(){if(r){r.abort();r=null}a=u;this.responseText="";this.responseXML="";h=true;if(this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||c)&&this.readyState!==this.DONE){c=false;m(this.DONE)}this.readyState=this.UNSENT};this.addEventListener=function(e,t){if(!(e in p)){p[e]=[]}p[e].push(t)};this.removeEventListener=function(e,t){if(e in p){p[e]=p[e].filter(function(e){return e!==t})}};this.dispatchEvent=function(t){if(typeof e["on"+t]==="function"){e["on"+t]()}if(t in p){for(var n=0,r=p[t].length;n<r;n++){p[t][n].call(e)}}};var m=function(t){if(e.readyState!==t){e.readyState=t;if(s.async||e.readyState<e.OPENED||e.readyState===e.DONE){e.dispatchEvent("readystatechange")}if(e.readyState===e.DONE&&!h){e.dispatchEvent("load");e.dispatchEvent("loadend")}}}};(function(e){e.Parse=e.Parse||{};e.Parse.VERSION="js1.2.8"})(this);(function(){var e=this;var t=e._;var n={};var r=Array.prototype,i=Object.prototype,s=Function.prototype;var o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty;var c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind;var x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=x}exports._=x}else{e._=x}x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c){e.forEach(t,r)}else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++){if(t.call(r,e[i],i,e)===n)return}}else{for(var o in e){if(x.has(e,o)){if(t.call(r,e[o],o,e)===n)return}}}};x.map=x.collect=function(e,t,n){var r=[];if(e==null)return r;if(h&&e.map===h)return e.map(t,n);T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)});return r};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(e==null)e=[];if(p&&e.reduce===p){if(r)t=x.bind(t,r);return i?e.reduce(t,n):e.reduce(t)}T(e,function(e,s,o){if(!i){n=e;i=true}else{n=t.call(r,n,e,s,o)}});if(!i)throw new TypeError(N);return n};x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(e==null)e=[];if(d&&e.reduceRight===d){if(r)t=x.bind(t,r);return i?e.reduceRight(t,n):e.reduceRight(t)}var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s;if(!i){n=e[a];i=true}else{n=t.call(r,n,e[a],a,f)}});if(!i)throw new TypeError(N);return n};x.find=x.detect=function(e,t,n){var r;C(e,function(e,i,s){if(t.call(n,e,i,s)){r=e;return true}});return r};x.filter=x.select=function(e,t,n){var r=[];if(e==null)return r;if(v&&e.filter===v)return e.filter(t,n);T(e,function(e,i,s){if(t.call(n,e,i,s))r[r.length]=e});return r};x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)};x.every=x.all=function(e,t,r){t||(t=x.identity);var i=true;if(e==null)return i;if(m&&e.every===m)return e.every(t,r);T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n});return!!i};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=false;if(e==null)return i;if(g&&e.some===g)return e.some(t,r);T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n});return!!i};x.contains=x.include=function(e,t){if(e==null)return false;if(y&&e.indexOf===y)return e.indexOf(t)!=-1;return C(e,function(e){return e===t})};x.invoke=function(e,t){var n=u.call(arguments,2);var r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})};x.pluck=function(e,t){return x.map(e,function(e){return e[t]})};x.where=function(e,t,n){if(x.isEmpty(t))return n?null:[];return x[n?"find":"filter"](e,function(e){for(var n in t){if(t[n]!==e[n])return false}return true})};x.findWhere=function(e,t){return x.where(e,t,true)};x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.max.apply(Math,e)}if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})});return r.value};x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535){return Math.min.apply(Math,e)}if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})});return r.value};x.shuffle=function(e){var t;var n=0;var r=[];T(e,function(e){t=x.random(n++);r[n-1]=r[t];r[t]=e});return r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria;var r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={};var s=k(t||x.identity);T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)});return i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})};x.countBy=function(e,t,n){return L(e,t,n,function(e,t){if(!x.has(e,t))e[t]=0;e[t]++})};x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t);var s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s};x.toArray=function(e){if(!e)return[];if(x.isArray(e))return u.call(e);if(e.length===+e.length)return x.map(e,x.identity);return x.values(e)};x.size=function(e){if(e==null)return 0;return e.length===+e.length?e.length:x.keys(e).length};x.first=x.head=x.take=function(e,t,n){if(e==null)return void 0;return t!=null&&!n?u.call(e,0,t):e[0]};x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))};x.last=function(e,t,n){if(e==null)return void 0;if(t!=null&&!n){return u.call(e,Math.max(e.length-t,0))}else{return e[e.length-1]}};x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)};x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){T(e,function(e){if(x.isArray(e)){t?o.apply(n,e):A(e,t,n)}else{n.push(e)}});return n};x.flatten=function(e,t){return A(e,t,[])};x.without=function(e){return x.difference(e,u.call(arguments,1))};x.uniq=x.unique=function(e,t,n,r){if(x.isFunction(t)){r=n;n=t;t=false}var i=n?x.map(e,n,r):e;var s=[];var o=[];T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n)){o.push(n);s.push(e[r])}});return s};x.union=function(){return x.uniq(a.apply(r,arguments))};x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})};x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})};x.zip=function(){var e=u.call(arguments);var t=x.max(x.pluck(e,"length"));var n=new Array(t);for(var r=0;r<t;r++){n[r]=x.pluck(e,""+r)}return n};x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++){if(t){n[e[r]]=t[r]}else{n[e[r][0]]=e[r][1]}}return n};x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n=="number"){r=n<0?Math.max(0,i+n):n}else{r=x.sortedIndex(e,t);return e[r]===t?r:-1}}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1};x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b){return r?e.lastIndexOf(t,n):e.lastIndexOf(t)}var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1};x.range=function(e,t,n){if(arguments.length<=1){t=e||0;e=0}n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0);var i=0;var s=new Array(r);while(i<r){s[i++]=e;e+=n}return s};x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}};x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}};x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)t=x.functions(e);T(t,function(t){e[t]=x.bind(e[t],e)});return e};x.memoize=function(e,t){var n={};t||(t=x.identity);return function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}};x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)};x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))};x.throttle=function(e,t){var n,r,i,s;var o=0;var u=function(){o=new Date;i=null;s=e.apply(n,r)};return function(){var a=new Date;var f=t-(a-o);n=this;r=arguments;if(f<=0){clearTimeout(i);i=null;o=a;s=e.apply(n,r)}else if(!i){i=setTimeout(u,f)}return s}};x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments;var u=function(){r=null;if(!n)i=e.apply(s,o)};var a=n&&!r;clearTimeout(r);r=setTimeout(u,t);if(a)i=e.apply(s,o);return i}};x.once=function(e){var t=false,n;return function(){if(t)return n;t=true;n=e.apply(this,arguments);e=null;return n}};x.wrap=function(e,t){return function(){var n=[e];o.apply(n,arguments);return t.apply(this,n)}};x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--){t=[e[n].apply(this,t)]}return t[0]}};x.after=function(e,t){if(e<=0)return t();return function(){if(--e<1){return t.apply(this,arguments)}}};x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)if(x.has(e,n))t[t.length]=n;return t};x.values=function(e){var t=[];for(var n in e)if(x.has(e,n))t.push(e[n]);return t};x.pairs=function(e){var t=[];for(var n in e)if(x.has(e,n))t.push([n,e[n]]);return t};x.invert=function(e){var t={};for(var n in e)if(x.has(e,n))t[e[n]]=n;return t};x.functions=x.methods=function(e){var t=[];for(var n in e){if(x.isFunction(e[n]))t.push(n)}return t.sort()};x.extend=function(e){T(u.call(arguments,1),function(t){if(t){for(var n in t){e[n]=t[n]}}});return e};x.pick=function(e){var t={};var n=a.apply(r,u.call(arguments,1));T(n,function(n){if(n in e)t[n]=e[n]});return t};x.omit=function(e){var t={};var n=a.apply(r,u.call(arguments,1));for(var i in e){if(!x.contains(n,i))t[i]=e[i]}return t};x.defaults=function(e){T(u.call(arguments,1),function(t){if(t){for(var n in t){if(e[n]==null)e[n]=t[n]}}});return e};x.clone=function(e){if(!x.isObject(e))return e;return x.isArray(e)?e.slice():x.extend({},e)};x.tap=function(e,t){t(e);return e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;if(e instanceof x)e=e._wrapped;if(t instanceof x)t=t._wrapped;var i=f.call(e);if(i!=f.call(t))return false;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return false;var s=n.length;while(s--){if(n[s]==e)return r[s]==t}n.push(e);r.push(t);var o=0,u=true;if(i=="[object Array]"){o=e.length;u=o==t.length;if(u){while(o--){if(!(u=O(e[o],t[o],n,r)))break}}}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l)){return false}for(var c in e){if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}}if(u){for(c in t){if(x.has(t,c)&&!(o--))break}u=!o}}n.pop();r.pop();return u};x.isEqual=function(e,t){return O(e,t,[],[])};x.isEmpty=function(e){if(e==null)return true;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return false;return true};x.isElement=function(e){return!!(e&&e.nodeType===1)};x.isArray=w||function(e){return f.call(e)=="[object Array]"};x.isObject=function(e){return e===Object(e)};T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}});if(!x.isArguments(arguments)){x.isArguments=function(e){return!!(e&&x.has(e,"callee"))}}if(typeof /./!=="function"){x.isFunction=function(e){return typeof e==="function"}}x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};x.isNaN=function(e){return x.isNumber(e)&&e!=+e};x.isBoolean=function(e){return e===true||e===false||f.call(e)=="[object Boolean]"};x.isNull=function(e){return e===null};x.isUndefined=function(e){return e===void 0};x.has=function(e,t){return l.call(e,t)};x.noConflict=function(){e._=t;return this};x.identity=function(e){return e};x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r};x.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){if(t==null)return"";return(""+t).replace(_[e],function(t){return M[e][t]})}});x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n};x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];o.apply(e,arguments);return j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t};x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/;var H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"};var B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g");var s=0;var o="__p+='";e.replace(i,function(t,n,r,i,u){o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]});if(n){o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"}if(r){o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"}if(i){o+="';\n"+i+"\n__p+='"}s=u+t.length;return t});o+="';\n";if(!n.variable)o="with(obj||{}){\n"+o+"}\n";o="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){u.source=o;throw u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};a.source="function("+(n.variable||"obj")+"){\n"+o+"}";return a};x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x);T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);if((e=="shift"||e=="splice")&&n.length===0)delete n[0];return j.call(this,n)}});T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}});x.extend(x.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;if(typeof exports!=="undefined"&&exports._){t._=exports._.noConflict();t.localStorage=db;t.XMLHttpRequest=XMLHttpRequest;exports.Parse=t}else{t._=_.noConflict();if(typeof localStorage!=="undefined"){t.localStorage=localStorage}if(typeof XMLHttpRequest!=="undefined"){t.XMLHttpRequest=XMLHttpRequest}}if(typeof $!=="undefined"){t.$=$}var n=function(){};var r=function(e,r,i){var s;if(r&&r.hasOwnProperty("constructor")){s=r.constructor}else{s=function(){e.apply(this,arguments)}}t._.extend(s,e);n.prototype=e.prototype;s.prototype=new n;if(r){t._.extend(s.prototype,r)}if(i){t._.extend(s,i)}s.prototype.constructor=s;s.__super__=e.prototype;return s};t.serverURL="https://api.parse.com";if(typeof process!=="undefined"&&process.versions&&process.versions.node){t._isNode=true}t.initialize=function(e,n,r){if(r){throw"Parse.initialize() was passed a Master Key, which is only "+"allowed from within Node.js."}t._initialize(e,n)};t._initialize=function(e,n,r){t.applicationId=e;t.javaScriptKey=n;t.masterKey=r;t._useMasterKey=false};if(t._isNode){t.initialize=t._initialize;t.Cloud=t.Cloud||{};t.Cloud.useMasterKey=function(){t._useMasterKey=true}}t._getParsePath=function(e){if(!t.applicationId){throw"You need to call Parse.initialize before using Parse."}if(!e){e=""}if(!t._.isString(e)){throw"Tried to get a localStorage path that wasn't a String."}if(e[0]==="/"){e=e.substring(1)}return"Parse/"+t.applicationId+"/"+e};t._installationId=null;t._getInstallationId=function(){if(t._installationId){return t._installationId}var e=t._getParsePath("installationId");t.localStorage=db2;console.log("localStorage",db2);console.log("Parse.localStorage",t.localStorage);t._installationId=t.localStorage.getItem(e);if(!t._installationId||t._installationId===""){var n=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)};t._installationId=n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n();t.localStorage.setItem(e,t._installationId)}return t._installationId};t._parseDate=function(e){var t=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})"+"T"+"([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})"+"(.([0-9]+))?"+"Z$");var n=t.exec(e);if(!n){return null}var r=n[1]||0;var i=(n[2]||1)-1;var s=n[3]||0;var o=n[4]||0;var u=n[5]||0;var a=n[6]||0;var f=n[8]||0;return new Date(Date.UTC(r,i,s,o,u,a,f))};t._ajaxIE8=function(e,n,r){var i=new t.Promise;var s=new XDomainRequest;s.onload=function(){var e;try{e=JSON.parse(s.responseText)}catch(t){i.reject(t)}if(e){i.resolve(e)}};s.onerror=s.ontimeout=function(){i.reject(s)};s.onprogress=function(){};s.open(e,n);s.send(r);return i};t._ajax=function(e,n,r,i,s){var o={success:i,error:s};if(typeof XDomainRequest!=="undefined"){return t._ajaxIE8(e,n,r)._thenRunCallbacks(o)}var u=new t.Promise;var a=false;var f=new t.XMLHttpRequest;f.onreadystatechange=function(){if(f.readyState===4){if(a){return}a=true;if(f.status>=200&&f.status<300){var e;try{e=JSON.parse(f.responseText)}catch(t){u.reject(t)}if(e){u.resolve(e,f.status,f)}}else{u.reject(f)}}};f.open(e,n,true);f.setRequestHeader("Content-Type","text/plain");if(t._isNode){f.setRequestHeader("User-Agent","Parse/"+t.VERSION+" (NodeJS "+process.versions.node+")")}f.send(r);return u._thenRunCallbacks(o)};t._extend=function(e,t){var n=r(this,e,t);n.extend=this.extend;return n};t._request=function(e,n,r,i,s){if(!t.applicationId){throw"You must specify your applicationId using Parse.initialize"}if(!t.javaScriptKey&&!t.masterKey){throw"You must specify a key using Parse.initialize"}if(e!=="batch"&&e!=="classes"&&e!=="files"&&e!=="functions"&&e!=="login"&&e!=="push"&&e!=="requestPasswordReset"&&e!=="users"){throw"Bad route: '"+e+"'."}var o=t.serverURL;if(o.charAt(o.length-1)!=="/"){o+="/"}o+="1/"+e;if(n){o+="/"+n}if(r){o+="/"+r}s=t._.clone(s||{});if(i!=="POST"){s._method=i;i="POST"}s._ApplicationId=t.applicationId;if(!t._useMasterKey){s._JavaScriptKey=t.javaScriptKey}else{s._MasterKey=t.masterKey}s._ClientVersion=t.VERSION;s._InstallationId=t._getInstallationId();var u=t.User.current();if(u&&u._sessionToken){s._SessionToken=u._sessionToken}var a=JSON.stringify(s);return t._ajax(i,o,a).then(null,function(e){var n;if(e&&e.responseText){try{var r=JSON.parse(e.responseText);if(r){n=new t.Error(r.code,r.error)}}catch(i){}}n=n||new t.Error(-1,e.responseText);return t.Promise.error(n)})};t._getValue=function(e,n){if(!(e&&e[n])){return null}return t._.isFunction(e[n])?e[n]():e[n]};t._encode=function(e,n,r){var i=t._;if(e instanceof t.Object){if(r){throw"Parse.Objects not allowed here"}if(!n||i.include(n,e)||!e._hasData){return e._toPointer()}if(!e.dirty()){n=n.concat(e);return t._encode(e._toFullJSON(n),n,r)}throw"Tried to save an object with a pointer to a new, unsaved object."}if(e instanceof t.ACL){return e.toJSON()}if(i.isDate(e)){return{__type:"Date",iso:e.toJSON()}}if(e instanceof t.GeoPoint){return e.toJSON()}if(i.isArray(e)){return i.map(e,function(e){return t._encode(e,n,r)})}if(i.isRegExp(e)){return e.source}if(e instanceof t.Relation){return e.toJSON()}if(e instanceof t.Op){return e.toJSON()}if(e instanceof t.File){if(!e.url()){throw"Tried to save an object containing an unsaved file."}return{__type:"File",name:e.name(),url:e.url()}}if(i.isObject(e)){var s={};t._objectEach(e,function(e,i){s[i]=t._encode(e,n,r)});return s}return e};t._decode=function(e,n){var r=t._;if(!r.isObject(n)){return n}if(r.isArray(n)){t._arrayEach(n,function(e,r){n[r]=t._decode(r,e)});return n}if(n instanceof t.Object){return n}if(n instanceof t.File){return n}if(n instanceof t.Op){return n}if(n.__op){return t.Op._decode(n)}if(n.__type==="Pointer"){var i=t.Object._create(n.className);i._finishFetch({objectId:n.objectId},false);return i}if(n.__type==="Object"){var s=n.className;delete n.__type;delete n.className;var o=t.Object._create(s);o._finishFetch(n,true);return o}if(n.__type==="Date"){return t._parseDate(n.iso)}if(n.__type==="GeoPoint"){return new t.GeoPoint({latitude:n.latitude,longitude:n.longitude})}if(e==="ACL"){if(n instanceof t.ACL){return n}return new t.ACL(n)}if(n.__type==="Relation"){var u=new t.Relation(null,e);u.targetClassName=n.className;return u}if(n.__type==="File"){var a=new t.File(n.name);a._url=n.url;return a}t._objectEach(n,function(e,r){n[r]=t._decode(r,e)});return n};t._arrayEach=t._.each;t._traverse=function(e,n,r){if(e instanceof t.Object){r=r||[];if(t._.indexOf(r,e)>=0){return}r.push(e);t._traverse(e.attributes,n,r);return n(e)}if(e instanceof t.Relation||e instanceof t.File){return n(e)}if(t._.isArray(e)){t._.each(e,function(i,s){var o=t._traverse(i,n,r);if(o){e[s]=o}});return n(e)}if(t._.isObject(e)){t._each(e,function(i,s){var o=t._traverse(i,n,r);if(o){e[s]=o}});return n(e)}return n(e)};t._objectEach=t._each=function(e,n){var r=t._;if(r.isObject(e)){r.each(r.keys(e),function(t){n(e[t],t)})}else{r.each(e,n)}};t._isNullOrUndefined=function(e){return t._.isNull(e)||t._.isUndefined(e)}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Error=function(e,t){this.code=e;this.message=t};n.extend(t.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252})})(this);(function(){var e=this;var t=e.Parse||(e.Parse={});var n=/\s+/;var r=Array.prototype.slice;t.Events={on:function(e,t,r){var i,s,o,u,a;if(!t){return this}e=e.split(n);i=this._callbacks||(this._callbacks={});s=e.shift();while(s){a=i[s];o=a?a.tail:{};o.next=u={};o.context=r;o.callback=t;i[s]={tail:u,next:a?a.next:o};s=e.shift()}return this},off:function(e,t,r){var i,s,o,u,a,f;if(!(s=this._callbacks)){return}if(!(e||t||r)){delete this._callbacks;return this}e=e?e.split(n):_.keys(s);i=e.shift();while(i){o=s[i];delete s[i];if(!o||!(t||r)){continue}u=o.tail;o=o.next;while(o!==u){a=o.callback;f=o.context;if(t&&a!==t||r&&f!==r){this.on(i,a,f)}o=o.next}i=e.shift()}return this},trigger:function(e){var t,i,s,o,u,a,f;if(!(s=this._callbacks)){return this}a=s.all;e=e.split(n);f=r.call(arguments,1);t=e.shift();while(t){i=s[t];if(i){o=i.tail;while((i=i.next)!==o){i.callback.apply(i.context||this,f)}}i=a;if(i){o=i.tail;u=[t].concat(f);while((i=i.next)!==o){i.callback.apply(i.context||this,u)}}t=e.shift()}return this}};t.Events.bind=t.Events.on;t.Events.unbind=t.Events.off}).call(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.GeoPoint=function(e,r){if(n.isArray(e)){t.GeoPoint._validate(e[0],e[1]);this.latitude=e[0];this.longitude=e[1]}else if(n.isObject(e)){t.GeoPoint._validate(e.latitude,e.longitude);this.latitude=e.latitude;this.longitude=e.longitude}else if(n.isNumber(e)&&n.isNumber(r)){t.GeoPoint._validate(e,r);this.latitude=e;this.longitude=r}else{this.latitude=0;this.longitude=0}var i=this;if(this.__defineGetter__&&this.__defineSetter__){this._latitude=this.latitude;this._longitude=this.longitude;this.__defineGetter__("latitude",function(){return i._latitude});this.__defineGetter__("longitude",function(){return i._longitude});this.__defineSetter__("latitude",function(e){t.GeoPoint._validate(e,i.longitude);i._latitude=e});this.__defineSetter__("longitude",function(e){t.GeoPoint._validate(i.latitude,e);i._longitude=e})}};t.GeoPoint._validate=function(e,t){if(e<-90){throw"Parse.GeoPoint latitude "+e+" < -90.0."}if(e>90){throw"Parse.GeoPoint latitude "+e+" > 90.0."}if(t<-180){throw"Parse.GeoPoint longitude "+t+" < -180.0."}if(t>180){throw"Parse.GeoPoint longitude "+t+" > 180.0."}};t.GeoPoint.current=function(e){var n=new t.Promise;navigator.geolocation.getCurrentPosition(function(e){n.resolve(new t.GeoPoint({latitude:e.coords.latitude,longitude:e.coords.longitude}))},function(e){n.reject(e)});return n._thenRunCallbacks(e)};t.GeoPoint.prototype={toJSON:function(){t.GeoPoint._validate(this.latitude,this.longitude);return{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(e){var t=Math.PI/180;var n=this.latitude*t;var r=this.longitude*t;var i=e.latitude*t;var s=e.longitude*t;var o=n-i;var u=r-s;var a=Math.sin(o/2);var f=Math.sin(u/2);var l=a*a+Math.cos(n)*Math.cos(i)*f*f;l=Math.min(1,l);return 2*Math.asin(Math.sqrt(l))},kilometersTo:function(e){return this.radiansTo(e)*6371},milesTo:function(e){return this.radiansTo(e)*3958.8}}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;var r="*";t.ACL=function(e){var r=this;r.permissionsById={};if(n.isObject(e)){if(e instanceof t.User){r.setReadAccess(e,true);r.setWriteAccess(e,true)}else{if(n.isFunction(e)){throw"Parse.ACL() called with a function.  Did you forget ()?"}t._objectEach(e,function(e,i){if(!n.isString(i)){throw"Tried to create an ACL with an invalid userId."}r.permissionsById[i]={};t._objectEach(e,function(e,t){if(t!=="read"&&t!=="write"){throw"Tried to create an ACL with an invalid permission type."}if(!n.isBoolean(e)){throw"Tried to create an ACL with an invalid permission value."}r.permissionsById[i][t]=e})})}}};t.ACL.prototype.toJSON=function(){return n.clone(this.permissionsById)};t.ACL.prototype._setAccess=function(e,r,i){if(r instanceof t.User){r=r.id}else if(r instanceof t.Role){r="role:"+r.getName()}if(!n.isString(r)){throw"userId must be a string."}if(!n.isBoolean(i)){throw"allowed must be either true or false."}var s=this.permissionsById[r];if(!s){if(!i){return}else{s={};this.permissionsById[r]=s}}if(i){this.permissionsById[r][e]=true}else{delete s[e];if(n.isEmpty(s)){delete s[r]}}};t.ACL.prototype._getAccess=function(e,n){if(n instanceof t.User){n=n.id}else if(n instanceof t.Role){n="role:"+n.getName()}var r=this.permissionsById[n];if(!r){return false}return r[e]?true:false};t.ACL.prototype.setReadAccess=function(e,t){this._setAccess("read",e,t)};t.ACL.prototype.getReadAccess=function(e){return this._getAccess("read",e)};t.ACL.prototype.setWriteAccess=function(e,t){this._setAccess("write",e,t)};t.ACL.prototype.getWriteAccess=function(e){return this._getAccess("write",e)};t.ACL.prototype.setPublicReadAccess=function(e){this.setReadAccess(r,e)};t.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(r)};t.ACL.prototype.setPublicWriteAccess=function(e){this.setWriteAccess(r,e)};t.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(r)};t.ACL.prototype.getRoleReadAccess=function(e){if(e instanceof t.Role){e=e.getName()}if(n.isString(e)){return this.getReadAccess("role:"+e)}throw"role must be a Parse.Role or a String"};t.ACL.prototype.getRoleWriteAccess=function(e){if(e instanceof t.Role){e=e.getName()}if(n.isString(e)){return this.getWriteAccess("role:"+e)}throw"role must be a Parse.Role or a String"};t.ACL.prototype.setRoleReadAccess=function(e,r){if(e instanceof t.Role){e=e.getName()}if(n.isString(e)){this.setReadAccess("role:"+e,r);return}throw"role must be a Parse.Role or a String"};t.ACL.prototype.setRoleWriteAccess=function(e,r){if(e instanceof t.Role){e=e.getName()}if(n.isString(e)){this.setWriteAccess("role:"+e,r);return}throw"role must be a Parse.Role or a String"}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Op=function(){this._initialize.apply(this,arguments)};t.Op.prototype={_initialize:function(){}};n.extend(t.Op,{_extend:t._extend,_opDecoderMap:{},_registerDecoder:function(e,n){t.Op._opDecoderMap[e]=n},_decode:function(e){var n=t.Op._opDecoderMap[e.__op];if(n){return n(e)}else{return undefined}}});t.Op._registerDecoder("Batch",function(e){var n=null;t._arrayEach(e.ops,function(e){e=t.Op._decode(e);n=e._mergeWithPrevious(n)});return n});t.Op.Set=t.Op._extend({_initialize:function(e){this._value=e},value:function(){return this._value},toJSON:function(){return t._encode(this.value())},_mergeWithPrevious:function(e){return this},_estimate:function(e){return this.value()}});t.Op._UNSET={};t.Op.Unset=t.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(e){return this},_estimate:function(e){return t.Op._UNSET}});t.Op._registerDecoder("Delete",function(e){return new t.Op.Unset});t.Op.Increment=t.Op._extend({_initialize:function(e){this._amount=e},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(e){if(!e){return this}else if(e instanceof t.Op.Unset){return new t.Op.Set(this.amount())}else if(e instanceof t.Op.Set){return new t.Op.Set(e.value()+this.amount())}else if(e instanceof t.Op.Increment){return new t.Op.Increment(this.amount()+e.amount())}else{throw"Op is invalid after previous op."}},_estimate:function(e){if(!e){return this.amount()}return e+this.amount()}});t.Op._registerDecoder("Increment",function(e){return new t.Op.Increment(e.amount)});t.Op.Add=t.Op._extend({_initialize:function(e){this._objects=e},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(!e){return this}else if(e instanceof t.Op.Unset){return new t.Op.Set(this.objects())}else if(e instanceof t.Op.Set){return new t.Op.Set(this._estimate(e.value()))}else if(e instanceof t.Op.Add){return new t.Op.Add(e.objects().concat(this.objects()))}else{throw"Op is invalid after previous op."}},_estimate:function(e){if(!e){return n.clone(this.objects())}else{return e.concat(this.objects())}}});t.Op._registerDecoder("Add",function(e){return new t.Op.Add(t._decode(undefined,e.objects))});t.Op.AddUnique=t.Op._extend({_initialize:function(e){this._objects=n.uniq(e)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(!e){return this}else if(e instanceof t.Op.Unset){return new t.Op.Set(this.objects())}else if(e instanceof t.Op.Set){return new t.Op.Set(this._estimate(e.value()))}else if(e instanceof t.Op.AddUnique){return new t.Op.AddUnique(this._estimate(e.objects()))}else{throw"Op is invalid after previous op."}},_estimate:function(e){if(!e){return n.clone(this.objects())}else{var r=n.clone(e);t._arrayEach(this.objects(),function(e){if(e instanceof t.Object&&e.id){var i=n.find(r,function(n){return n instanceof t.Object&&n.id===e.id});if(!i){r.push(e)}else{var s=n.indexOf(r,i);r[s]=e}}else if(!n.contains(r,e)){r.push(e)}});return r}}});t.Op._registerDecoder("AddUnique",function(e){return new t.Op.AddUnique(t._decode(undefined,e.objects))});t.Op.Remove=t.Op._extend({_initialize:function(e){this._objects=n.uniq(e)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(!e){return this}else if(e instanceof t.Op.Unset){return e}else if(e instanceof t.Op.Set){return new t.Op.Set(this._estimate(e.value()))}else if(e instanceof t.Op.Remove){return new t.Op.Remove(n.union(e.objects(),this.objects()))}else{throw"Op is invalid after previous op."}},_estimate:function(e){if(!e){return[]}else{var r=n.difference(e,this.objects());t._arrayEach(this.objects(),function(e){if(e instanceof t.Object&&e.id){r=n.reject(r,function(n){return n instanceof t.Object&&n.id===e.id})}});return r}}});t.Op._registerDecoder("Remove",function(e){return new t.Op.Remove(t._decode(undefined,e.objects))});t.Op.Relation=t.Op._extend({_initialize:function(e,r){this._targetClassName=null;var i=this;var s=function(e){if(e instanceof t.Object){if(!e.id){throw"You can't add an unsaved Parse.Object to a relation."}if(!i._targetClassName){i._targetClassName=e.className}if(i._targetClassName!==e.className){throw"Tried to create a Parse.Relation with 2 different types: "+i._targetClassName+" and "+e.className+"."}return e.id}return e};this.relationsToAdd=n.uniq(n.map(e,s));this.relationsToRemove=n.uniq(n.map(r,s))},added:function(){var e=this;return n.map(this.relationsToAdd,function(n){var r=t.Object._create(e._targetClassName);r.id=n;return r})},removed:function(){var e=this;return n.map(this.relationsToRemove,function(n){var r=t.Object._create(e._targetClassName);r.id=n;return r})},toJSON:function(){var e=null;var t=null;var r=this;var i=function(e){return{__type:"Pointer",className:r._targetClassName,objectId:e}};var s=null;if(this.relationsToAdd.length>0){s=n.map(this.relationsToAdd,i);e={__op:"AddRelation",objects:s}}if(this.relationsToRemove.length>0){s=n.map(this.relationsToRemove,i);t={__op:"RemoveRelation",objects:s}}if(e&&t){return{__op:"Batch",ops:[e,t]}}return e||t||{}},_mergeWithPrevious:function(e){if(!e){return this}else if(e instanceof t.Op.Unset){throw"You can't modify a relation after deleting it."}else if(e instanceof t.Op.Relation){if(e._targetClassName&&e._targetClassName!==this._targetClassName){throw"Related object must be of class "+e._targetClassName+", but "+this._targetClassName+" was passed in."}var r=n.union(n.difference(e.relationsToAdd,this.relationsToRemove),this.relationsToAdd);var i=n.union(n.difference(e.relationsToRemove,this.relationsToAdd),this.relationsToRemove);var s=new t.Op.Relation(r,i);s._targetClassName=this._targetClassName;return s}else{throw"Op is invalid after previous op."}},_estimate:function(e,n,r){if(!e){var i=new t.Relation(n,r);i.targetClassName=this._targetClassName}else if(e instanceof t.Relation){if(this._targetClassName){if(e.targetClassName){if(e.targetClassName!==this._targetClassName){throw"Related object must be a "+e.targetClassName+", but a "+this._targetClassName+" was passed in."}}else{e.targetClassName=this._targetClassName}}return e}else{throw"Op is invalid after previous op."}}});t.Op._registerDecoder("AddRelation",function(e){return new t.Op.Relation(t._decode(undefined,e.objects),[])});t.Op._registerDecoder("RemoveRelation",function(e){return new t.Op.Relation([],t._decode(undefined,e.objects))})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Relation=function(e,t){this.parent=e;this.key=t;this.targetClassName=null};t.Relation.prototype={_ensureParentAndKey:function(e,t){this.parent=this.parent||e;this.key=this.key||t;if(this.parent!==e){throw"Internal Error. Relation retrieved from two different Objects."}if(this.key!==t){throw"Internal Error. Relation retrieved from two different keys."}},add:function(e){if(!n.isArray(e)){e=[e]}var r=new t.Op.Relation(e,[]);this.parent.set(this.key,r);this.targetClassName=r._targetClassName},remove:function(e){if(!n.isArray(e)){e=[e]}var r=new t.Op.Relation([],e);this.parent.set(this.key,r);this.targetClassName=r._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var e;var n;if(!this.targetClassName){e=t.Object._getSubclass(this.parent.className);n=new t.Query(e);n._extraOptions.redirectClassNameForKey=this.key}else{e=t.Object._getSubclass(this.targetClassName);n=new t.Query(e)}n._addCondition("$relatedTo","object",this.parent._toPointer());n._addCondition("$relatedTo","key",this.key);return n}}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Promise=function(){this._resolved=false;this._rejected=false;this._resolvedCallbacks=[];this._rejectedCallbacks=[]};n.extend(t.Promise,{is:function(e){return e&&e.then&&n.isFunction(e.then)},as:function(){var e=new t.Promise;e.resolve.apply(e,arguments);return e},error:function(){var e=new t.Promise;e.reject.apply(e,arguments);return e},when:function(e){var n;if(e&&t._isNullOrUndefined(e.length)){n=arguments}else{n=e}var r=n.length;var i=false;var s=[];var o=[];s.length=n.length;o.length=n.length;if(r===0){return t.Promise.as.apply(this,s)}var u=new t.Promise;var a=function(){r=r-1;if(r===0){if(i){u.reject(o)}else{u.resolve.apply(u,s)}}};t._arrayEach(n,function(e,n){if(t.Promise.is(e)){e.then(function(e){s[n]=e;a()},function(e){o[n]=e;i=true;a()})}else{s[n]=e;a()}});return u},_continueWhile:function(e,n){if(e()){return n().then(function(){return t.Promise._continueWhile(e,n)})}return t.Promise.as()}});n.extend(t.Promise.prototype,{resolve:function(e){if(this._resolved||this._rejected){throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+"."}this._resolved=true;this._result=arguments;var n=arguments;t._arrayEach(this._resolvedCallbacks,function(e){e.apply(this,n)});this._resolvedCallbacks=[];this._rejectedCallbacks=[]},reject:function(e){if(this._resolved||this._rejected){throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+"."}this._rejected=true;this._error=e;t._arrayEach(this._rejectedCallbacks,function(t){t(e)});this._resolvedCallbacks=[];this._rejectedCallbacks=[]},then:function(e,n){var r=new t.Promise;var i=function(){var n=arguments;if(e){n=[e.apply(this,n)]}if(n.length===1&&t.Promise.is(n[0])){n[0].then(function(){r.resolve.apply(r,arguments)},function(e){r.reject(e)})}else{r.resolve.apply(r,n)}};var s=function(e){var i=[];if(n){i=[n(e)];if(i.length===1&&t.Promise.is(i[0])){i[0].then(function(){r.resolve.apply(r,arguments)},function(e){r.reject(e)})}else{r.reject(i[0])}}else{r.reject(e)}};if(this._resolved){i.apply(this,this._result)}else if(this._rejected){s(this._error)}else{this._resolvedCallbacks.push(i);this._rejectedCallbacks.push(s)}return r},_thenRunCallbacks:function(e,r){var i;if(n.isFunction(e)){var s=e;i={success:function(e){s(e,null)},error:function(e){s(null,e)}}}else{i=n.clone(e)}i=i||{};return this.then(function(e){if(i.success){i.success.apply(this,arguments)}else if(r){r.trigger("sync",r,e,i)}return t.Promise.as.apply(t.Promise,arguments)},function(e){if(i.error){if(!n.isUndefined(r)){i.error(r,e)}else{i.error(e)}}else if(r){r.trigger("error",r,e,i)}return t.Promise.error(e)})},_continueWith:function(e){return this.then(function(){return e(arguments,null)},function(t){return e(null,t)})}})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;var r=function(e){if(e<26){return String.fromCharCode(65+e)}if(e<52){return String.fromCharCode(97+(e-26))}if(e<62){return String.fromCharCode(48+(e-52))}if(e===62){return"+"}if(e===63){return"/"}throw"Tried to encode large digit "+e+" in base64."};var i=function(e){var t=[];t.length=Math.ceil(e.length/3);n.times(t.length,function(n){var i=e[n*3];var s=e[n*3+1]||0;var o=e[n*3+2]||0;var u=n*3+1<e.length;var a=n*3+2<e.length;t[n]=[r(i>>2&63),r(i<<4&48|s>>4&15),u?r(s<<2&60|o>>6&3):"=",a?r(o&63):"="].join("")});return t.join("")};var s={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml."+"document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml."+"template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml."+"presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml."+"template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml."+"slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml."+"template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"};var o=function(e,n){var r=new t.Promise;if(typeof FileReader==="undefined"){return t.Promise.error(new t.Error(-1,"Attempted to use a FileReader on an unsupported browser."))}var i=new FileReader;i.onloadend=function(){if(i.readyState!==2){r.reject(new t.Error(-1,"Error reading file."));return}var e=i.result;var s=/^data:([^;]*);base64,(.*)$/.exec(e);if(!s){r.reject(new t.Error(-1,"Unable to interpret data URL: "+e));return}r.resolve(s[2],n||s[1])};i.readAsDataURL(e);return r};t.File=function(e,r,u){this._name=e;var a=/\.([^.]*)$/.exec(e);if(a){a=a[1].toLowerCase()}var f=u||s[a]||"text/plain";if(n.isArray(r)){this._source=t.Promise.as(i(r),f)}else if(r&&r.base64){this._source=t.Promise.as(r.base64,f)}else if(typeof File!=="undefined"&&r instanceof File){this._source=o(r,u)}else if(n.isString(r)){throw"Creating a Parse.File from a String is not yet supported."}};t.File.prototype={name:function(){return this._name},url:function(){return this._url},save:function(e){var n=this;if(!n._previousSave){n._previousSave=n._source.then(function(e,r){var i={base64:e,_ContentType:r};return t._request("files",n._name,null,"POST",i)}).then(function(e){n._name=e.name;n._url=e.url;return n})}return n._previousSave._thenRunCallbacks(e)}}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Object=function(e,r){if(n.isString(e)){return t.Object._create.apply(this,arguments)}e=e||{};if(r&&r.parse){e=this.parse(e)}var i=t._getValue(this,"defaults");if(i){e=n.extend({},i,e)}if(r&&r.collection){this.collection=r.collection}this._serverData={};this._opSetQueue=[{}];this.attributes={};this._hashedJSON={};this._escapedAttributes={};this.cid=n.uniqueId("c");this.changed={};this._silent={};this._pending={};if(!this.set(e,{silent:true})){throw new Error("Can't create an invalid Parse.Object")}this.changed={};this._silent={};this._pending={};this._hasData=true;this._previousAttributes=n.clone(this.attributes);this.initialize.apply(this,arguments)};t.Object.saveAll=function(e,n){return t.Object._deepSaveAsync(e)._thenRunCallbacks(n)};n.extend(t.Object.prototype,t.Events,{_existed:false,initialize:function(){},toJSON:function(){var e=this._toFullJSON();t._arrayEach(["__type","className"],function(t){delete e[t]});return e},_toFullJSON:function(e){var r=n.clone(this.attributes);t._objectEach(r,function(n,i){r[i]=t._encode(n,e)});t._objectEach(this._operations,function(e,t){r[t]=e});if(n.has(this,"id")){r.objectId=this.id}if(n.has(this,"createdAt")){if(n.isDate(this.createdAt)){r.createdAt=this.createdAt.toJSON()}else{r.createdAt=this.createdAt}}if(n.has(this,"updatedAt")){if(n.isDate(this.updatedAt)){r.updatedAt=this.updatedAt.toJSON()}else{r.updatedAt=this.updatedAt}}r.__type="Object";r.className=this.className;return r},_refreshCache:function(){var e=this;if(e._refreshingCache){return}e._refreshingCache=true;t._objectEach(this.attributes,function(r,i){if(r instanceof t.Object){r._refreshCache()}else if(n.isObject(r)){if(e._resetCacheForKey(i)){e.set(i,new t.Op.Set(r),{silent:true})}}});delete e._refreshingCache},dirty:function(e){this._refreshCache();var t=n.last(this._opSetQueue);if(e){return t[e]?true:false}if(!this.id){return true}if(n.keys(t).length>0){return true}return false},_toPointer:function(){if(!this.id){throw new Error("Can't serialize an unsaved Parse.Object")}return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(e){return this.attributes[e]},relation:function(e){var n=this.get(e);if(n){if(!(n instanceof t.Relation)){throw"Called relation() on non-relation field "+e}n._ensureParentAndKey(this,e);return n}else{return new t.Relation(this,e)}},escape:function(e){var r=this._escapedAttributes[e];if(r){return r}var i=this.attributes[e];var s;if(t._isNullOrUndefined(i)){s=""}else{s=n.escape(i.toString())}this._escapedAttributes[e]=s;return s},has:function(e){return!t._isNullOrUndefined(this.attributes[e])},_mergeMagicFields:function(e){var r=this;var i=["id","objectId","createdAt","updatedAt"];t._arrayEach(i,function(i){if(e[i]){if(i==="objectId"){r.id=e[i]}else if((i==="createdAt"||i==="updatedAt")&&!n.isDate(e[i])){r[i]=t._parseDate(e[i])}else{r[i]=e[i]}delete e[i]}})},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var e=this;var r=n.first(this._opSetQueue);this._opSetQueue=n.rest(this._opSetQueue);var i=n.first(this._opSetQueue);t._objectEach(r,function(e,t){var n=r[t];var s=i[t];if(n&&s){i[t]=s._mergeWithPrevious(n)}else if(n){i[t]=n}});this._saving=this._saving-1},_finishSave:function(e){var r={};t._traverse(this.attributes,function(e){if(e instanceof t.Object&&e.id&&e._hasData){r[e.id]=e}});var i=n.first(this._opSetQueue);this._opSetQueue=n.rest(this._opSetQueue);this._applyOpSet(i,this._serverData);this._mergeMagicFields(e);var s=this;t._objectEach(e,function(e,n){s._serverData[n]=t._decode(n,e);var i=t._traverse(s._serverData[n],function(e){if(e instanceof t.Object&&r[e.id]){return r[e.id]}});if(i){s._serverData[n]=i}});this._rebuildAllEstimatedData();this._saving=this._saving-1},_finishFetch:function(e,n){this._opSetQueue=[{}];this._mergeMagicFields(e);var r=this;t._objectEach(e,function(e,n){r._serverData[n]=t._decode(n,e)});this._rebuildAllEstimatedData();this._refreshCache();this._opSetQueue=[{}];this._hasData=n},_applyOpSet:function(e,n){var r=this;t._objectEach(e,function(e,i){n[i]=e._estimate(n[i],r,i);if(n[i]===t.Op._UNSET){delete n[i]}})},_resetCacheForKey:function(e){var r=this.attributes[e];if(n.isObject(r)&&!(r instanceof t.Object)&&!(r instanceof t.File)){r=r.toJSON?r.toJSON():r;var i=JSON.stringify(r);if(this._hashedJSON[e]!==i){this._hashedJSON[e]=i;return true}}return false},_rebuildEstimatedDataForKey:function(e){var n=this;delete this.attributes[e];if(this._serverData[e]){this.attributes[e]=this._serverData[e]}t._arrayEach(this._opSetQueue,function(r){var i=r[e];if(i){n.attributes[e]=i._estimate(n.attributes[e],n,e);if(n.attributes[e]===t.Op._UNSET){delete n.attributes[e]}else{n._resetCacheForKey(e)}}})},_rebuildAllEstimatedData:function(){var e=this;var r=n.clone(this.attributes);this.attributes=n.clone(this._serverData);t._arrayEach(this._opSetQueue,function(n){e._applyOpSet(n,e.attributes);t._objectEach(n,function(t,n){e._resetCacheForKey(n)})});t._objectEach(r,function(t,n){if(e.attributes[n]!==t){e.trigger("change:"+n,e,e.attributes[n],{})}});t._objectEach(this.attributes,function(t,i){if(!n.has(r,i)){e.trigger("change:"+i,e,t,{})}})},set:function(e,r,i){var s,o;if(n.isObject(e)||t._isNullOrUndefined(e)){s=e;t._objectEach(s,function(e,n){s[n]=t._decode(n,e)});i=r}else{s={};s[e]=t._decode(e,r)}i=i||{};if(!s){return this}if(s instanceof t.Object){s=s.attributes}if(i.unset){t._objectEach(s,function(e,n){s[n]=new t.Op.Unset})}var u=n.clone(s);var a=this;t._objectEach(u,function(e,n){if(e instanceof t.Op){u[n]=e._estimate(a.attributes[n],a,n);if(u[n]===t.Op._UNSET){delete u[n]}}});if(!this._validate(s,i)){return false}this._mergeMagicFields(s);i.changes={};var f=this._escapedAttributes;var l=this._previousAttributes||{};t._arrayEach(n.keys(s),function(e){var r=s[e];if(r instanceof t.Relation){r.parent=a}if(!(r instanceof t.Op)){r=new t.Op.Set(r)}var o=true;if(r instanceof t.Op.Set&&n.isEqual(a.attributes[e],r.value)){o=false}if(o){delete f[e];if(i.silent){a._silent[e]=true}else{i.changes[e]=true}}var u=n.last(a._opSetQueue);u[e]=r._mergeWithPrevious(u[e]);a._rebuildEstimatedDataForKey(e);if(o){a.changed[e]=a.attributes[e];if(!i.silent){a._pending[e]=true}}else{delete a.changed[e];delete a._pending[e]}});if(!i.silent){this.change(i)}return this},unset:function(e,t){t=t||{};t.unset=true;return this.set(e,null,t)},increment:function(e,r){if(n.isUndefined(r)||n.isNull(r)){r=1}return this.set(e,new t.Op.Increment(r))},add:function(e,n){return this.set(e,new t.Op.Add([n]))},addUnique:function(e,n){return this.set(e,new t.Op.AddUnique([n]))},remove:function(e,n){return this.set(e,new t.Op.Remove([n]))},op:function(e){return n.last(this._opSetQueue)[e]},clear:function(e){e=e||{};e.unset=true;var t=n.extend(this.attributes,this._operations);return this.set(t,e)},_getSaveJSON:function(){var e=n.clone(n.first(this._opSetQueue));t._objectEach(e,function(t,n){e[n]=t.toJSON()});return e},_canBeSerialized:function(){return t.Object._canBeSerializedAsValue(this.attributes)},fetch:function(e){var n=this;var r=t._request("classes",this.className,this.id,"GET");return r.then(function(e,t,r){n._finishFetch(n.parse(e,t,r),true);return n})._thenRunCallbacks(e,this)},save:function(e,r,i){var s,o,u,a,f;if(n.isObject(e)||t._isNullOrUndefined(e)){o=e;a=r}else{o={};o[e]=r;a=i}if(!a&&o){var l=n.reject(o,function(e,t){return n.include(["success","error","wait"],t)});if(l.length===0){var c=true;if(n.has(o,"success")&&!n.isFunction(o.success)){c=false}if(n.has(o,"error")&&!n.isFunction(o.error)){c=false}if(c){return this.save(null,o)}}}a=n.clone(a)||{};if(a.wait){u=n.clone(this.attributes)}var h=n.clone(a)||{};if(h.wait){h.silent=true}var p;h.error=function(e,t){p=t};if(o&&!this.set(o,h)){return t.Promise.error(p)._thenRunCallbacks(a,this)}var d=this;d._refreshCache();var v=[];var m=[];t.Object._findUnsavedChildren(d.attributes,v,m);if(v.length+m.length>0){return t.Object._deepSaveAsync(this.attributes).then(function(){return d.save(null,a)},function(e){return t.Promise.error(e)._thenRunCallbacks(a,d)})}this._startSave();this._saving=(this._saving||0)+1;this._allPreviousSaves=this._allPreviousSaves||t.Promise.as();this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var e=d.id?"PUT":"POST";var r=d._getSaveJSON();var i="classes";var s=d.className;if(d.className==="_User"&&!d.id){i="users";s=null}var f=t._request(i,s,d.id,e,r);f=f.then(function(e,t,r){var i=d.parse(e,t,r);if(a.wait){i=n.extend(o||{},i)}d._finishSave(i);if(a.wait){d.set(u,h)}return d},function(e){d._cancelSave();return t.Promise.error(e)})._thenRunCallbacks(a,d);return f});return this._allPreviousSaves},destroy:function(e){e=e||{};var n=this;var r=function(){n.trigger("destroy",n,n.collection,e)};if(!this.id){return r()}if(!e.wait){r()}var i=t._request("classes",this.className,this.id,"DELETE");return i.then(function(){if(e.wait){r()}return n})._thenRunCallbacks(e,this)},parse:function(e,r,i){var s=n.clone(e);n(["createdAt","updatedAt"]).each(function(e){if(s[e]){s[e]=t._parseDate(s[e])}});if(!s.updatedAt){s.updatedAt=s.createdAt}if(r){this._existed=r!==201}return s},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(e){e=e||{};var r=this._changing;this._changing=true;var i=this;t._objectEach(this._silent,function(e){i._pending[e]=true});var s=n.extend({},e.changes,this._silent);this._silent={};t._objectEach(s,function(t,n){i.trigger("change:"+n,i,i.get(n),e)});if(r){return this}var o=function(e,t){if(!i._pending[t]&&!i._silent[t]){delete i.changed[t]}};while(!n.isEmpty(this._pending)){this._pending={};this.trigger("change",this,e);t._objectEach(this.changed,o);i._previousAttributes=n.clone(this.attributes)}this._changing=false;return this},existed:function(){return this._existed},hasChanged:function(e){if(!arguments.length){return!n.isEmpty(this.changed)}return this.changed&&n.has(this.changed,e)},changedAttributes:function(e){if(!e){return this.hasChanged()?n.clone(this.changed):false}var r={};var i=this._previousAttributes;t._objectEach(e,function(e,t){if(!n.isEqual(i[t],e)){r[t]=e}});return r},previous:function(e){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(e,r){if(n.has(e,"ACL")&&!(e.ACL instanceof t.ACL)){return new t.Error(t.Error.OTHER_CAUSE,"ACL must be a Parse.ACL.")}return false},_validate:function(e,t){if(t.silent||!this.validate){return true}e=n.extend({},this.attributes,e);var r=this.validate(e,t);if(!r){return true}if(t&&t.error){t.error(this,r,t)}else{this.trigger("error",this,r,t)}return false},getACL:function(){return this.get("ACL")},setACL:function(e,t){return this.set("ACL",e,t)}});t.Object._getSubclass=function(e){if(!n.isString(e)){throw"Parse.Object._getSubclass requires a string argument."}var r=t.Object._classMap[e];if(!r){r=t.Object.extend(e);t.Object._classMap[e]=r}return r};t.Object._create=function(e,n,r){var i=t.Object._getSubclass(e);return new i(n,r)};t.Object._classMap={};t.Object._extend=t._extend;t.Object.extend=function(e,r,i){if(!n.isString(e)){if(e&&n.has(e,"className")){return t.Object.extend(e.className,e,r)}else{throw new Error("Parse.Object.extend's first argument should be the className.")}}if(e==="User"){e="_User"}var s=null;if(n.has(t.Object._classMap,e)){var o=t.Object._classMap[e];s=o._extend(r,i)}else{r=r||{};r.className=e;s=this._extend(r,i)}s.extend=function(r){if(n.isString(r)||r&&n.has(r,"className")){return t.Object.extend.apply(s,arguments)}var i=[e].concat(t._.toArray(arguments));return t.Object.extend.apply(s,i)};t.Object._classMap[e]=s;return s};t.Object._findUnsavedChildren=function(e,n,r){t._traverse(e,function(e){if(e instanceof t.Object){e._refreshCache();if(e.dirty()){n.push(e)}return}if(e instanceof t.File){if(!e.url()){r.push(e)}return}})};t.Object._canBeSerializedAsValue=function(e){var r=true;if(e instanceof t.Object){r=!!e.id}else if(n.isArray(e)){t._arrayEach(e,function(e){if(!t.Object._canBeSerializedAsValue(e)){r=false}})}else if(n.isObject(e)){t._objectEach(e,function(e){if(!t.Object._canBeSerializedAsValue(e)){r=false}})}return r};t.Object._deepSaveAsync=function(e){var r=[];var i=[];t.Object._findUnsavedChildren(e,r,i);var s=t.Promise.as();n.each(i,function(e){s=s.then(function(){return e.save()})});var o=n.uniq(r);var u=n.uniq(o);return s.then(function(){return t.Promise._continueWhile(function(){return u.length>0},function(){var e=[];var r=[];t._arrayEach(u,function(t){if(e.length>20){r.push(t);return}if(t._canBeSerialized()){e.push(t)}else{r.push(t)}});u=r;if(e.length===0){return t.Promise.error(new t.Error(t.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."))}var i=t.Promise.when(n.map(e,function(e){return e._allPreviousSaves||t.Promise.as()}));var s=new t.Promise;t._arrayEach(e,function(e){e._allPreviousSaves=s});return i._continueWith(function(){return t._request("batch",null,null,"POST",{requests:n.map(e,function(e){var t=e._getSaveJSON();var n="POST";var r="/1/classes/"+e.className;if(e.id){r=r+"/"+e.id;n="PUT"}e._startSave();return{method:n,path:r,body:t}})}).then(function(n,r,i){var s;t._arrayEach(e,function(e,t){if(n[t].success){e._finishSave(e.parse(n[t].success,r,i))}else{s=s||n[t].error;e._cancelSave()}});if(s){return t.Promise.error(new t.Error(s.code,s.error))}}).then(function(e){s.resolve(e);return e},function(e){s.reject(e);return t.Promise.error(e)})})})}).then(function(){return e})}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Role=t.Object.extend("_Role",{constructor:function(e,r){if(n.isString(e)&&r instanceof t.ACL){t.Object.prototype.constructor.call(this,null,null);this.setName(e);this.setACL(r)}else{t.Object.prototype.constructor.call(this,e,r)}},getName:function(){return this.get("name")},setName:function(e,t){return this.set("name",e,t)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(e,r){if("name"in e&&e.name!==this.getName()){var i=e.name;if(this.id&&this.id!==e.objectId){return new t.Error(t.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.")}if(!n.isString(i)){return new t.Error(t.Error.OTHER_CAUSE,"A role's name must be a String.")}if(!/^[0-9a-zA-Z\-_ ]+$/.test(i)){return new t.Error(t.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _,"+" -, and spaces.")}}if(t.Object.prototype.validate){return t.Object.prototype.validate.call(this,e,r)}return false}})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Collection=function(e,t){t=t||{};if(t.comparator){this.comparator=t.comparator}if(t.model){this.model=t.model}if(t.query){this.query=t.query}this._reset();this.initialize.apply(this,arguments);if(e){this.reset(e,{silent:true,parse:t.parse})}};n.extend(t.Collection.prototype,t.Events,{model:t.Object,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,r){var i,s,o,u,a,f,l={},c={};r=r||{};e=n.isArray(e)?e.slice():[e];for(i=0,o=e.length;i<o;i++){e[i]=this._prepareModel(e[i],r);u=e[i];if(!u){throw new Error("Can't add an invalid model to a collection")}a=u.cid;if(l[a]||this._byCid[a]){throw new Error("Duplicate cid: can't add the same model "+"to a collection twice")}f=u.id;if(!t._isNullOrUndefined(f)&&(c[f]||this._byId[f])){throw new Error("Duplicate id: can't add the same model "+"to a collection twice")}c[f]=u;l[a]=u}for(i=0;i<o;i++){(u=e[i]).on("all",this._onModelEvent,this);this._byCid[u.cid]=u;if(u.id){this._byId[u.id]=u}}this.length+=o;s=t._isNullOrUndefined(r.at)?this.models.length:r.at;this.models.splice.apply(this.models,[s,0].concat(e));if(this.comparator){this.sort({silent:true})}if(r.silent){return this}for(i=0,o=this.models.length;i<o;i++){u=this.models[i];if(l[u.cid]){r.index=i;u.trigger("add",u,this,r)}}return this},remove:function(e,t){var r,i,s,o;t=t||{};e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o){continue}delete this._byId[o.id];delete this._byCid[o.cid];s=this.indexOf(o);this.models.splice(s,1);this.length--;if(!t.silent){t.index=s;o.trigger("remove",o,this,t)}this._removeReference(o)}return this},get:function(e){return e&&this._byId[e.id||e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){e=e||{};if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var t=n.bind(this.comparator,this);if(this.comparator.length===1){this.models=this.sortBy(t)}else{this.models.sort(t)}if(!e.silent){this.trigger("reset",this,e)}return this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,n){var r=this;e=e||[];n=n||{};t._arrayEach(this.models,function(e){r._removeReference(e)});this._reset();this.add(e,{silent:true,parse:n.parse});if(!n.silent){this.trigger("reset",this,n)}return this},fetch:function(e){e=n.clone(e)||{};if(e.parse===undefined){e.parse=true}var r=this;var i=this.query||new t.Query(this.model);return i.find().then(function(t){if(e.add){r.add(t,e)}else{r.reset(t,e)}return r})._thenRunCallbacks(e,this)},create:function(e,t){var r=this;t=t?n.clone(t):{};e=this._prepareModel(e,t);if(!e){return false}if(!t.wait){r.add(e,t)}var i=t.success;t.success=function(n,s,o){if(t.wait){r.add(n,t)}if(i){i(n,s)}else{n.trigger("sync",e,s,t)}};e.save(null,t);return e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(e,n){if(!(e instanceof t.Object)){var r=e;n.collection=this;e=new this.model(r,n);if(!e._validate(e.attributes,n)){e=false}}else if(!e.collection){e.collection=this}return e},_removeReference:function(e){if(this===e.collection){delete e.collection}e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this){return}if(e==="destroy"){this.remove(t,r)}if(t&&e==="change:objectId"){delete this._byId[t.previous("objectId")];this._byId[t.id]=t}this.trigger.apply(this,arguments)}});var r=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];t._arrayEach(r,function(e){t.Collection.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});t.Collection.extend=t._extend})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.View=function(e){this.cid=n.uniqueId("view");this._configure(e||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var r=/^(\S+)\s*(.*)$/;var i=["model","collection","el","id","attributes","className","tagName"];n.extend(t.View.prototype,t.Events,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(e,n,r){var i=document.createElement(e);if(n){t.$(i).attr(n)}if(r){t.$(i).html(r)}return i},setElement:function(e,n){this.$el=t.$(e);this.el=this.$el[0];if(n!==false){this.delegateEvents()}return this},delegateEvents:function(e){e=e||t._getValue(this,"events");if(!e){return}this.undelegateEvents();var i=this;t._objectEach(e,function(t,s){if(!n.isFunction(t)){t=i[e[s]]}if(!t){throw new Error('Event "'+e[s]+'" does not exist')}var o=s.match(r);var u=o[1],a=o[2];t=n.bind(t,i);u+=".delegateEvents"+i.cid;if(a===""){i.$el.bind(u,t)}else{i.$el.delegate(a,u,t)}})},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){if(this.options){e=n.extend({},this.options,e)}var t=this;n.each(i,function(n){if(e[n]){t[n]=e[n]}});this.options=e},_ensureElement:function(){if(!this.el){var e=t._getValue(this,"attributes")||{};if(this.id){e.id=this.id}if(this.className){e["class"]=this.className}this.setElement(this.make(this.tagName,e),false)}else{this.setElement(this.el,false)}}});t.View.extend=t._extend})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.User=t.Object.extend("_User",{_isCurrentUser:false,_mergeMagicFields:function(e){if(e.sessionToken){this._sessionToken=e.sessionToken;delete e.sessionToken}t.User.__super__._mergeMagicFields.call(this,e)},_cleanupAuthData:function(){if(!this.isCurrent()){return}var e=this.get("authData");if(!e){return}t._objectEach(this.get("authData"),function(t,n){if(!e[n]){delete e[n]}})},_synchronizeAllAuthData:function(){var e=this.get("authData");if(!e){return}var n=this;t._objectEach(this.get("authData"),function(e,t){n._synchronizeAuthData(t)})},_synchronizeAuthData:function(e){if(!this.isCurrent()){return}var r;if(n.isString(e)){r=e;e=t.User._authProviders[r]}else{r=e.getAuthType()}var i=this.get("authData");if(!i||!e){return}var s=e.restoreAuthentication(i[r]);if(!s){this._unlinkFrom(e)}},_handleSaveResult:function(e){if(e){this._isCurrentUser=true}this._cleanupAuthData();this._synchronizeAllAuthData();delete this._serverData.password;this._rebuildEstimatedDataForKey("password");this._refreshCache();if(e||this.isCurrent()){t.User._saveCurrentUser(this)}},_linkWith:function(e,r){var i;if(n.isString(e)){i=e;e=t.User._authProviders[e]}else{i=e.getAuthType()}if(n.has(r,"authData")){var s=this.get("authData")||{};s[i]=r.authData;this.set("authData",s);var o=n.clone(r)||{};o.success=function(e){e._handleSaveResult(true);if(r.success){r.success.apply(this,arguments)}};return this.save({authData:s},o)}else{var u=this;var a=new t.Promise;e.authenticate({success:function(e,t){u._linkWith(e,{authData:t,success:r.success,error:r.error}).then(function(){a.resolve(u)})},error:function(e,t){if(r.error){r.error(u,t)}a.reject(t)}});return a}},_unlinkFrom:function(e,r){var i;if(n.isString(e)){i=e;e=t.User._authProviders[e]}else{i=e.getAuthType()}var s=n.clone(r);var o=this;s.authData=null;s.success=function(t){o._synchronizeAuthData(e);if(r.success){r.success.apply(this,arguments)}};return this._linkWith(e,s)},_isLinked:function(e){var t;if(n.isString(e)){t=e}else{t=e.getAuthType()}var r=this.get("authData")||{};return!!r[t]},_logOutWithAll:function(){var e=this.get("authData");if(!e){return}var n=this;t._objectEach(this.get("authData"),function(e,t){n._logOutWith(t)})},_logOutWith:function(e){if(!this.isCurrent()){return}if(n.isString(e)){e=t.User._authProviders[e]}if(e&&e.deauthenticate){e.deauthenticate()}},signUp:function(e,r){var i;r=r||{};var s=e&&e.username||this.get("username");if(!s||s===""){i=new t.Error(t.Error.OTHER_CAUSE,"Cannot sign up user with an empty name.");if(r&&r.error){r.error(this,i)}return t.Promise.error(i)}var o=e&&e.password||this.get("password");if(!o||o===""){i=new t.Error(t.Error.OTHER_CAUSE,"Cannot sign up user with an empty password.");if(r&&r.error){r.error(this,i)}return t.Promise.error(i)}var u=n.clone(r);u.success=function(e){e._handleSaveResult(true);if(r.success){r.success.apply(this,arguments)}};return this.save(e,u)},logIn:function(e){var n=this;var r=t._request("login",null,null,"GET",this.toJSON());return r.then(function(e,t,r){var i=n.parse(e,t,r);n._finishFetch(i);n._handleSaveResult(true);return n})._thenRunCallbacks(e,this)},save:function(e,r,i){var s,o,u,a,f;if(n.isObject(e)||n.isNull(e)||n.isUndefined(e)){o=e;a=r}else{o={};o[e]=r;a=i}a=a||{};var l=n.clone(a);l.success=function(e){e._handleSaveResult(false);if(a.success){a.success.apply(this,arguments)}};return t.Object.prototype.save.call(this,o,l)},fetch:function(e){var r=e?n.clone(e):{};r.success=function(t){t._handleSaveResult(false);if(e&&e.success){e.success.apply(this,arguments)}};return t.Object.prototype.fetch.call(this,r)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(e,t){return this.set("username",e,t)},setPassword:function(e,t){return this.set("password",e,t)},getEmail:function(){return this.get("email")},setEmail:function(e,t){return this.set("email",e,t)},authenticated:function(){return!!this._sessionToken&&t.User.current()&&t.User.current().id===this.id}},{_currentUser:null,_currentUserMatchesDisk:false,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function(e,n,r,i){r=r||{};r.username=e;r.password=n;var s=t.Object._create("_User");return s.signUp(r,i)},logIn:function(e,n,r){var i=t.Object._create("_User");i._finishFetch({username:e,password:n});return i.logIn(r)},logOut:function(){if(t.User._currentUser!==null){t.User._currentUser._logOutWithAll();t.User._currentUser._isCurrentUser=false}t.User._currentUserMatchesDisk=true;t.User._currentUser=null;t.localStorage.removeItem(t._getParsePath(t.User._CURRENT_USER_KEY))},requestPasswordReset:function(e,n){var r={email:e};var i=t._request("requestPasswordReset",null,null,"POST",r);return i._thenRunCallbacks(n)},current:function(){if(t.User._currentUser){return t.User._currentUser}if(t.User._currentUserMatchesDisk){return t.User._currentUser}t.User._currentUserMatchesDisk=true;var e=t.localStorage.getItem(t._getParsePath(t.User._CURRENT_USER_KEY));if(!e){return null}t.User._currentUser=t.Object._create("_User");t.User._currentUser._isCurrentUser=true;var n=JSON.parse(e);t.User._currentUser.id=n._id;delete n._id;t.User._currentUser._sessionToken=n._sessionToken;delete n._sessionToken;t.User._currentUser.set(n);t.User._currentUser._synchronizeAllAuthData();t.User._currentUser._refreshCache();t.User._currentUser._opSetQueue=[{}];return t.User._currentUser},_saveCurrentUser:function(e){if(t.User._currentUser!==e){t.User.logOut()}e._isCurrentUser=true;t.User._currentUser=e;t.User._currentUserMatchesDisk=true;var n=e.toJSON();n._id=e.id;n._sessionToken=e._sessionToken;t.localStorage.setItem(t._getParsePath(t.User._CURRENT_USER_KEY),JSON.stringify(n))},_registerAuthenticationProvider:function(e){t.User._authProviders[e.getAuthType()]=e;if(t.User.current()){t.User.current()._synchronizeAuthData(e.getAuthType())}},_logInWith:function(e,n){var r=t.Object._create("_User");return r._linkWith(e,n)}})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Query=function(e){if(n.isString(e)){e=t.Object._getSubclass(e)}this.objectClass=e;this.className=e.prototype.className;this._where={};this._include=[];this._limit=-1;this._skip=0;this._extraOptions={}};t.Query.or=function(){var e=n.toArray(arguments);var r=null;t._arrayEach(e,function(e){if(n.isNull(r)){r=e.className}if(r!==e.className){throw"All queries must be for the same class"}});var i=new t.Query(r);i._orQuery(e);return i};t.Query.prototype={get:function(e,n){var r=this;r.equalTo("objectId",e);return r.first().then(function(e){if(e){return e}var n=new t.Error(t.Error.OBJECT_NOT_FOUND,"Object not found.");return t.Promise.error(n)})._thenRunCallbacks(n,null)},toJSON:function(){var e={where:this._where};if(this._include.length>0){e.include=this._include.join(",")}if(this._select){e.keys=this._select.join(",")}if(this._limit>=0){e.limit=this._limit}if(this._skip>0){e.skip=this._skip}if(this._order!==undefined){e.order=this._order}t._objectEach(this._extraOptions,function(t,n){e[n]=t});return e},find:function(e){var r=this;var i=t._request("classes",this.className,null,"GET",this.toJSON());return i.then(function(e){return n.map(e.results,function(n){var i;if(e.className){i=new t.Object(e.className)}else{i=new r.objectClass}i._finishFetch(n,true);return i})})._thenRunCallbacks(e)},count:function(e){var n=this.toJSON();n.limit=0;n.count=1;var r=t._request("classes",this.className,null,"GET",n);return r.then(function(e){return e.count})._thenRunCallbacks(e)},first:function(e){var r=this;var i=this.toJSON();i.limit=1;var s=t._request("classes",this.className,null,"GET",i);return s.then(function(e){return n.map(e.results,function(e){var t=new r.objectClass;t._finishFetch(e,true);return t})[0]})._thenRunCallbacks(e)},collection:function(e,r){r=r||{};return new t.Collection(e,n.extend(r,{model:this.objectClass,query:this}))},skip:function(e){this._skip=e;return this},limit:function(e){this._limit=e;return this},equalTo:function(e,n){this._where[e]=t._encode(n);return this},_addCondition:function(e,n,r){if(!this._where[e]){this._where[e]={}}this._where[e][n]=t._encode(r);return this},notEqualTo:function(e,t){this._addCondition(e,"$ne",t);return this},lessThan:function(e,t){this._addCondition(e,"$lt",t);return this},greaterThan:function(e,t){this._addCondition(e,"$gt",t);return this},lessThanOrEqualTo:function(e,t){this._addCondition(e,"$lte",t);return this},greaterThanOrEqualTo:function(e,t){this._addCondition(e,"$gte",t);return this},containedIn:function(e,t){this._addCondition(e,"$in",t);return this},notContainedIn:function(e,t){this._addCondition(e,"$nin",t);return this},containsAll:function(e,t){this._addCondition(e,"$all",t);return this},exists:function(e){this._addCondition(e,"$exists",true);return this},doesNotExist:function(e){this._addCondition(e,"$exists",false);return this},matches:function(e,t,n){this._addCondition(e,"$regex",t);if(!n){n=""}if(t.ignoreCase){n+="i"}if(t.multiline){n+="m"}if(n&&n.length){this._addCondition(e,"$options",n)}return this},matchesQuery:function(e,t){var n=t.toJSON();n.className=t.className;this._addCondition(e,"$inQuery",n);return this},doesNotMatchQuery:function(e,t){var n=t.toJSON();n.className=t.className;this._addCondition(e,"$notInQuery",n);return this},matchesKeyInQuery:function(e,t,n){var r=n.toJSON();r.className=n.className;this._addCondition(e,"$select",{key:t,query:r});return this},doesNotMatchKeyInQuery:function(e,t,n){var r=n.toJSON();r.className=n.className;this._addCondition(e,"$dontSelect",{key:t,query:r});return this},_orQuery:function(e){var t=n.map(e,function(e){return e.toJSON().where});this._where.$or=t;return this},_quote:function(e){return"\\Q"+e.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(e,t){this._addCondition(e,"$regex",this._quote(t));return this},startsWith:function(e,t){this._addCondition(e,"$regex","^"+this._quote(t));return this},endsWith:function(e,t){this._addCondition(e,"$regex",this._quote(t)+"$");return this},ascending:function(e){this._order=e;return this},descending:function(e){this._order="-"+e;return this},near:function(e,n){if(!(n instanceof t.GeoPoint)){n=new t.GeoPoint(n)}this._addCondition(e,"$nearSphere",n);return this},withinRadians:function(e,t,n){this.near(e,t);this._addCondition(e,"$maxDistance",n);return this},withinMiles:function(e,t,n){return this.withinRadians(e,t,n/3958.8)},withinKilometers:function(e,t,n){return this.withinRadians(e,t,n/6371)},withinGeoBox:function(e,n,r){if(!(n instanceof t.GeoPoint)){n=new t.GeoPoint(n)}if(!(r instanceof t.GeoPoint)){r=new t.GeoPoint(r)}this._addCondition(e,"$within",{$box:[n,r]});return this},include:function(){var e=this;t._arrayEach(arguments,function(t){if(n.isArray(t)){e._include=e._include.concat(t)}else{e._include.push(t)}});return this},select:function(){var e=this;this._select=this._select||[];t._arrayEach(arguments,function(t){if(n.isArray(t)){e._select=e._select.concat(t)}else{e._select.push(t)}});return this},each:function(e,r){r=r||{};if(this._order||this._skip||this._limit>=0){var i="Cannot iterate on a query with sort, skip, or limit.";return t.Promise.error(i)._thenRunCallbacks(r)}var s=new t.Promise;var o=new t.Query(this.objectClass);o._limit=r.batchSize||100;o._where=n.clone(this._where);o._include=n.clone(this._include);o.ascending("objectId");var u=false;return t.Promise._continueWhile(function(){return!u},function(){return o.find().then(function(n){var r=t.Promise.as();t._.each(n,function(t){r=r.then(function(){return e(t)})});return r.then(function(){if(n.length>=o._limit){o.greaterThan("objectId",n[n.length-1].id)}else{u=true}})})})._thenRunCallbacks(r)}}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;var r="*";var i=false;var s;var o;var u={authenticate:function(e){var t=this;FB.login(function(n){if(n.authResponse){if(e.success){e.success(t,{id:n.authResponse.userID,access_token:n.authResponse.accessToken,expiration_date:(new Date(n.authResponse.expiresIn*1e3+(new Date).getTime())).toJSON()})}}else{if(e.error){e.error(t,n)}}},{scope:s})},restoreAuthentication:function(e){if(e){var r={userID:e.id,accessToken:e.access_token,expiresIn:(t._parseDate(e.expiration_date).getTime()-(new Date).getTime())/1e3};var i=n.clone(o);i.authResponse=r;i.status=false;FB.init(i)}return true},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null);FB.logout()}};t.FacebookUtils={init:function(e){if(typeof FB==="undefined"){throw"The Facebook JavaScript SDK must be loaded before calling init."}o=n.clone(e)||{};if(o.status&&typeof console!=="undefined"){var r=console.warn||console.log||function(){};r.call(console,"The 'status' flag passed into"+" FB.init, when set to true, can interfere with Parse Facebook"+" integration, so it has been suppressed. Please call"+" FB.getLoginStatus() explicitly if you require this behavior.")}o.status=false;FB.init(o);t.User._registerAuthenticationProvider(u);i=true},isLinked:function(e){return e._isLinked("facebook")},logIn:function(e,r){if(!e||n.isString(e)){if(!i){throw"You must initialize FacebookUtils before calling logIn."}s=e;return t.User._logInWith("facebook",r)}else{var o=n.clone(r)||{};o.authData=e;return t.User._logInWith("facebook",o)}},link:function(e,t,r){if(!t||n.isString(t)){if(!i){throw"You must initialize FacebookUtils before calling link."}s=t;return e._linkWith("facebook",r)}else{var o=n.clone(r)||{};o.authData=t;return e._linkWith("facebook",o)}},unlink:function(e,t){if(!i){throw"You must initialize FacebookUtils before calling unlink."}return e._unlinkFrom("facebook",t)}}})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.History=function(){this.handlers=[];n.bindAll(this,"checkUrl")};var r=/^[#\/]/;var i=/msie [\w.]+/;t.History.started=false;n.extend(t.History.prototype,t.Events,{interval:50,getHash:function(e){var t=e?e.location:window.location;var n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,n){if(t._isNullOrUndefined(e)){if(this._hasPushState||n){e=window.location.pathname;var i=window.location.search;if(i){e+=i}}else{e=this.getHash()}}if(!e.indexOf(this.options.root)){e=e.substr(this.options.root.length)}return e.replace(r,"")},start:function(e){if(t.History.started){throw new Error("Parse.history has already been started")}t.History.started=true;this.options=n.extend({},{root:"/"},this.options,e);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var s=this.getFragment();var o=document.documentMode;var u=i.exec(navigator.userAgent.toLowerCase())&&(!o||o<=7);if(u){this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(s)}if(this._hasPushState){t.$(window).bind("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!u){t.$(window).bind("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)}this.fragment=s;var a=window.location;var f=a.pathname===this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else if(this._wantsPushState&&this._hasPushState&&f&&a.hash){this.fragment=this.getHash().replace(r,"");window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)}if(!this.options.silent){return this.loadUrl()}},stop:function(){t.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);window.clearInterval(this._checkUrlInterval);t.History.started=false},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe){t=this.getFragment(this.getHash(this.iframe))}if(t===this.fragment){return false}if(this.iframe){this.navigate(t)}if(!this.loadUrl()){this.loadUrl(this.getHash())}},loadUrl:function(e){var t=this.fragment=this.getFragment(e);var r=n.any(this.handlers,function(e){if(e.route.test(t)){e.callback(t);return true}});return r},navigate:function(e,n){if(!t.History.started){return false}if(!n||n===true){n={trigger:n}}var i=(e||"").replace(r,"");if(this.fragment===i){return}if(this._hasPushState){if(i.indexOf(this.options.root)!==0){i=this.options.root+i}this.fragment=i;var s=n.replace?"replaceState":"pushState";window.history[s]({},document.title,i)}else if(this._wantsHashChange){this.fragment=i;this._updateHash(window.location,i,n.replace);if(this.iframe&&i!==this.getFragment(this.getHash(this.iframe))){if(!n.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,i,n.replace)}}else{window.location.assign(this.options.root+e)}if(n.trigger){this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var r=e.toString().replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else{e.hash=t}}})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Router=function(e){e=e||{};if(e.routes){this.routes=e.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var r=/:\w+/g;var i=/\*\w+/g;var s=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;n.extend(t.Router.prototype,t.Events,{initialize:function(){},route:function(e,r,i){t.history=t.history||new t.History;if(!n.isRegExp(e)){e=this._routeToRegExp(e)}if(!i){i=this[r]}t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);if(i){i.apply(this,s)}this.trigger.apply(this,["route:"+r].concat(s));t.history.trigger("route",this,r,s)},this));return this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes){return}var e=[];for(var t in this.routes){if(this.routes.hasOwnProperty(t)){e.unshift([t,this.routes[t]])}}for(var n=0,r=e.length;n<r;n++){this.route(e[n][0],e[n][1],this[e[n][1]])}},_routeToRegExp:function(e){e=e.replace(s,"\\$&").replace(r,"([^/]+)").replace(i,"(.*?)");return new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});t.Router.extend=t._extend})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;var n=t._;t.Cloud=t.Cloud||{};n.extend(t.Cloud,{run:function(e,n,r){var i=t._request("functions",e,null,"POST",t._encode(n,null,true));return i.then(function(e){return t._decode(null,e).result})._thenRunCallbacks(r)}})})(this);(function(e){e.Parse=e.Parse||{};var t=e.Parse;t.Installation=t.Object.extend("_Installation");t.Push=t.Push||{};t.Push.send=function(e,n){if(e.where){e.where=e.where.toJSON().where}if(e.push_time){e.push_time=e.push_time.toJSON()}if(e.expiration_time){e.expiration_time=e.expiration_time.toJSON()}if(e.expiration_time&&e.expiration_time_interval){throw"Both expiration_time and expiration_time_interval can't be set"}var r=t._request("push",null,null,"POST",e);return r._thenRunCallbacks(n)}})(this)




//var require = __meteor_bootstrap__.require;
//var path = require('path');
//var base = path.resolve('.');
//var isBundle = path.existsSync(base + '/bundle');
//var modulePath = base + (isBundle ? '/bundle/static' : '/public') + '/node_modules';
//
//var parse = require(modulePath + '/parse');
//
//var Parse = Meteor.require("parse");
//
//var parse = Parse();

//console.log("parse", Parse);
//console.log("Parse", Parse);
//
//                   console.log("t", t);
// 5 is the number of intervals between invoking the job
// so this job will happen once every 5 minute
Parse.initialize("s63Zhx2UDmSjVDlWWrj7BGnGMRq5Wpj4XwE0drzp", "peqVL2vDLfG8QwF1jmIDWbi8XZFbjbTJXaZf1eFl");

//var query = new Parse.Query(Parse.Installation);
//query.equalTo('times', true);
//query.equalTo('channels', 'Vulcans');
////        console.log("Parse function", Parse);
////        console.log("\n\n\n\n\nParse Push", Parse.Push);
//Parse.Push.send({
//    where: query,
//    data: {
//        alert: "When do we take to outer space"
//    }
//}, {
//    success: function() {
//        console.log("Push was successful");
//    },
//    error: function(error) {
//        console.error(error);
//    }
//});

MyCron.addJob(720, function() {
    var _users = Meteor.users.find({});
    var _now = moment().add("days", 1).hours(0).minutes(0).seconds(0).milliseconds(0)._d;
    console.log('we get the', _now);
    _users.forEach(function(user) {
        console.log("we get the users");
        var _repCount = Items.find({user: user._id, deactivated: false, nextRepetition: {$lte: _now}, actualTimesRepeated: {$gt: 0}}).count();
        console.log("Rep count", _repCount);



//        Parse.Push.send ({
//        channels: [ "test"],
//            data: {
//                alert: "test2"
//            }
//        });

        Parse.Push.send({
            channels: [ user._id ],
            data: {
                alert: "You have " + _repCount + " repetitions due! Wanna get a couple done?",
                badge: _repCount,
                title: "TheBrain is bored!"
            }
        }, {
            success: function() {
                console.log("push successful for user", user._id);
                // Push was successful
            },
            error: function(error) {
                console.log("push unsuccessful for user", user._id);

                // Handle error
            }
        });
        console.log("User", user._id, "has so many reps ", _repCount);
    })
    console.log('tick');
});